# StEx 数据源选型说明

当前采集使用 **免费接口**（akshare 东方财富等），适合本机、低频、研究用途。若遇到限流、RemoteDisconnected、需要更全/更稳/实时数据，可考虑付费或带积分的数据源。

---

## 何时考虑付费/积分接口

- **免费接口经常断**：如东方财富 RemoteDisconnected、限流
- **需要稳定、可 SLA**：日更/实时行情、回测、生产环境
- **需要更全字段**：财务、资金流、分钟/秒级、龙虎榜等
- **调用量大**：免费接口有频率和条数限制

---

## 推荐付费/积分数据源（中国市场 A 股）

### 1. Tushare Pro（积分制，有免费额度）

| 项目     | 说明 |
|----------|------|
| 官网     | https://tushare.pro |
| 模式     | 注册送积分，按积分开放接口；可捐助或加群换积分（如 200 元/年 ≈ 2000 积分） |
| 数据     | A 股行情、基本面、财务、指数、资金流等；日线 120 积分起，高频/特色需更高积分 |
| 接口     | Python `tushare`，REST API，与现有 `stex.corp` / `stock_day` 等表易对接 |
| 适合     | 个人/小团队、中低频、已有 Python 栈 |

**对接思路**：在 `backend-services` 里加 `collectors/tushare_*.py`，用 `TS_TOKEN` 调 Tushare Pro，写入 `stex.corp` / `stex.stock_day` 等；与 akshare 并存，用环境变量或配置切换数据源。

---

### 2. 聚宽 JoinQuant（量化平台 + 本地 JQData）

| 项目     | 说明 |
|----------|------|
| 官网     | https://www.joinquant.com |
| 模式     | 免费有每日流量上限；付费可提高限额或买本地 JQData |
| 数据     | 2005 年至今 A 股行情、财务、因子、期货、期权、基金等 |
| 接口     | Python `jqdatasdk`（`pip install jqdatasdk`），本地调用 |
| 适合     | 量化回测、因子研究、需要长历史与因子库 |

**对接思路**：用 `jqdatasdk` 取股票列表、行情、基本面，写进现有 DB 表；可在 `corp_agent` 旁加 `jq_corp_agent` 或通过配置切换。

---

### 3. 同花顺 iFinD / 量化数据接口

| 项目     | 说明 |
|----------|------|
| 官网     | https://quant.10jqka.com.cn 、 https://quantapi.10jqka.com.cn |
| 模式     | 付费，按品种与频率定价 |
| 数据     | 股票/基金/债券/期货/期权，日频到秒级，2000+ 表 |
| 接口     | 多语言 SDK、REST，支持 Python |
| 适合     | 对实时或高频、全品种有要求的机构/团队 |

---

### 4. 万得 Wind

| 项目     | 说明 |
|----------|------|
| 官网     | https://www.wind.com.cn |
| 模式     | 机构付费，价格较高 |
| 数据     | 全球市场、宏观、研报、资金流等，覆盖最全 |
| 接口     | Python/MATLAB/R/C++ 等，Wind 终端 + API |
| 适合     | 机构、需要全球多资产与研报数据 |

---

## 本项目已接入 Tushare Pro

- **配置**：在 `backend-services/.env` 中设置  
  `DATA_SOURCE=tushare`、`TUSHARE_TOKEN=你的token`（https://tushare.pro 注册后获取）。
- **采集**：前端选股页点击「采集 A 股板块上市公司基础数据」，或命令行执行 `python3 run_corp_agent.py`，会按 `DATA_SOURCE` 调用 Tushare Pro 或 akshare。
- **表结构**：与 akshare 共用 `stex.corp`（code/name/market/industry/sector/list_date/market_cap/pe/pb），无需改表。

## 在本项目里接入其他付费源（建议做法）

1. **统一写入现有表**  
   不论 akshare 还是 Tushare/聚宽，都写入 `stex.corp`、`stex.stock_day` 等，选股/股票页无需改。

2. **用配置切换数据源**  
   - 已支持：`DATA_SOURCE=tushare` 或 `akshare`，`TUSHARE_TOKEN` 用于 Tushare Pro。
   - 聚宽：可增加 `DATA_SOURCE=joinquant` 与对应 collector。

3. **采集层抽象**  
   - 已实现：`agents/corp_agent.py`（akshare）、`agents/tushare_corp_agent.py`（Tushare Pro），trigger 按 `DATA_SOURCE` 二选一。

4. **成本优先可先试**  
   - **Tushare Pro**：有免费积分，先跑通日线/列表，再按需捐助或加群换积分。  
   - **聚宽**：免费额度先试，需要再考虑付费或 JQData。

---

## 小结

| 需求           | 可优先考虑   |
|----------------|--------------|
| 少花钱、先跑通 | Tushare Pro（积分）、akshare（免费） |
| 量化回测/因子  | 聚宽 JoinQuant                      |
| 实时/全品种    | 同花顺量化接口                      |
| 机构/全市场    | 万得 Wind                           |

当前 StEx 表结构（corp、stock_day、fundamentals 等）与上述数据源都可兼容，接入付费源时只需新增 collector 和配置，不必改表结构。
